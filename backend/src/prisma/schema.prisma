// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Admin {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  password  String
  role      AdminRole @default(DOCUMENT_ADMIN)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  createdTeams Team[] @relation("CreatedBy")
  verifiedDocuments Document[] @relation("VerifiedBy")

  @@map("admins")
}

model Team {
  id        String   @id @default(cuid())
  teamId    String   @unique @map("team_id")
  teamName  String   @map("team_name")
  paymentId String?  @map("payment_id")
  regId     String?  @map("reg_id")
  createdBy String   @map("created_by")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  creator Admin @relation("CreatedBy", fields: [createdBy], references: [id])
  members TeamMember[]

  @@map("teams")
}

model TeamMember {
  id           String   @id @default(cuid())
  teamId       String   @map("team_id")
  name         String
  email        String   @unique
  password     String
  role         MemberRole @default(MEMBER)
  accessGranted Boolean @default(true) @map("access_granted")
  status       MemberStatus @default(ACTIVE)
  lastLogin    DateTime? @map("last_login")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  // Relations
  team Team @relation(fields: [teamId], references: [id], onDelete: Cascade)
  documents Document[]
  notifications Notification[]

  @@map("team_members")
}

model Document {
  id           String   @id @default(cuid())
  memberId     String   @map("member_id")
  docType      String   @map("doc_type")
  fileName     String   @map("file_name")
  fileUrl      String   @map("file_url")
  fileSize     Int      @map("file_size")
  mimeType     String   @map("mime_type")
  status       DocumentStatus @default(PENDING)
  adminComment String?  @map("admin_comment")
  verifiedBy   String?  @map("verified_by")
  verifiedAt   DateTime? @map("verified_at")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  // Relations
  member TeamMember @relation(fields: [memberId], references: [id], onDelete: Cascade)
  verifier Admin? @relation("VerifiedBy", fields: [verifiedBy], references: [id])

  @@map("documents")
}

model Notification {
  id        String   @id @default(cuid())
  userId    String   @map("user_id")
  type      NotificationType
  title     String
  message   String
  isRead    Boolean  @default(false) @map("is_read")
  createdAt DateTime @default(now()) @map("created_at")

  // Relations
  user TeamMember @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notifications")
}

// Enums
enum AdminRole {
  SUPER_ADMIN
  DOCUMENT_ADMIN
}

enum MemberRole {
  LEADER
  MEMBER
}

enum MemberStatus {
  ACTIVE
  INACTIVE
}

enum DocumentStatus {
  PENDING
  APPROVED
  REJECTED
}

enum NotificationType {
  EMAIL
  IN_APP
}
